/**
 * Task 1: 线程包装类 - 实践练习
 *
 * 编译并运行测试:
 *   g++ -std=c++11 -pthread main.cpp -o main && ./main
 *
 * 说明:
 *   请在标记 "TODO" 的地方填写代码，完成后运行程序验证你的实现。
 */

#include "../common/utils.cpp"
#include <chrono>
#include <functional>
#include <iostream>
#include <thread>

// ============================================================
// Thread 类定义
//
// 实现一个线程包装类，封装 std::thread，提供以下功能：
// 1. 接受一个函数对象（接受 int 参数的函数）
// 2. 为每个线程分配唯一的 ID
// 3. 提供 start() 方法启动线程
// 4. 提供 getId() 获取线程 ID
// ============================================================

class Thread
{
public:
    using ThreadFunc = std::function<void(int)>;

    // ============================================================
    // 练习 1: 实现构造函数
    //
    // 任务: 保存传入的函数对象，并生成唯一的线程 ID
    //
    // 提示:
    //   - 使用初始化列表初始化 func_ 和 threadId_
    //   - threadId_ 应该使用 generateId_ 生成唯一值
    //   - generateId_ 是静态变量，每次使用后需要递增
    // ============================================================
    Thread(ThreadFunc func)
        // TODO: 实现初始化列表
        : func_(func), threadId_(++generateId_)
    {
        // TODO: 如果需要，在构造函数体中添加代码
    }

    ~Thread() = default;

    // ============================================================
    // 练习 2: 实现 start 方法
    //
    // 任务: 创建并启动线程
    //
    // 提示:
    //   - 创建 std::thread 对象，传入 func_ 和 threadId_
    //   - 使用 detach() 让线程在后台运行
    //   - 线程池场景中使用 detach 是因为工作线程是长期运行的
    // ============================================================
    void start()
    {
        std::thread t(func_, threadId_);
        t.detach();
        // TODO: 实现线程启动逻辑
        // 1. 创建 std::thread 对象
        // 2. 调用 detach()
    }

    // ============================================================
    // 练习 3: 实现 getId 方法
    //
    // 任务: 返回线程的唯一 ID
    // ============================================================
    int getId() const
    {
        
        // TODO: 返回 threadId_
        return threadId_; // 修改这行
    }

private:
    ThreadFunc func_;
    static int generateId_;
    int threadId_;
};

// ============================================================
// 练习 4: 定义静态成员变量
//
// 任务: 在类外定义并初始化静态成员变量 generateId_
//
// 提示:
//   - 静态成员变量必须在类外定义
//   - 初始值应该是 0
// ============================================================

// TODO: 定义 Thread::generateId_
int Thread::generateId_ = 0;

// ============================================================
// 主函数 - 运行自动测试
// ============================================================

int main()
{
    return run_autograder();
}
