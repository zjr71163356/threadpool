# Task 0: ç¯å¢ƒå‡†å¤‡ä¸å¤šçº¿ç¨‹åŸºç¡€

**é¢„è®¡æ—¶é—´ï¼š** 30-60 åˆ†é’Ÿ
**éš¾åº¦ï¼š** â­ å…¥é—¨

---

## ğŸ“– å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬ä»»åŠ¡åï¼Œä½ å°†ï¼š
- âœ… é…ç½®å¥½ C++11 å¼€å‘ç¯å¢ƒ
- âœ… ç†è§£çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ
- âœ… æŒæ¡ `std::thread` çš„åŸºæœ¬ç”¨æ³•
- âœ… ç†è§£ join å’Œ detach çš„åŒºåˆ«
- âœ… äº†è§£æ•°æ®ç«äº‰çš„æ¦‚å¿µ

---

## ğŸ¯ ä»»åŠ¡å†…å®¹

### 1. ç¯å¢ƒé…ç½®

#### æ£€æŸ¥ç¼–è¯‘å™¨ç‰ˆæœ¬
```bash
g++ --version  # éœ€è¦ GCC 4.8+ æˆ– Clang 3.3+
```

#### ç¼–è¯‘æµ‹è¯•
```bash
cd /home/tyrfly1001/threadpool
g++ -std=c++11 -pthread tasks/task0_example.cpp -o task0_test
./task0_test
```

### 2. ç†è§£ std::thread åŸºç¡€

#### 2.1 åˆ›å»ºå’Œå¯åŠ¨çº¿ç¨‹

```cpp
#include <iostream>
#include <thread>

void hello() {
    std::cout << "Hello from thread!" << std::endl;
}

int main() {
    std::thread t(hello);  // åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹
    t.join();              // ç­‰å¾…çº¿ç¨‹å®Œæˆ
    return 0;
}
```

**å…³é”®ç‚¹ï¼š**
- `std::thread` æ„é€ æ—¶çº¿ç¨‹å°±å¼€å§‹è¿è¡Œ
- å¿…é¡»è°ƒç”¨ `join()` æˆ– `detach()`ï¼Œå¦åˆ™ææ„æ—¶ä¼šè°ƒç”¨ `std::terminate()`

#### 2.2 ä¼ é€’å‚æ•°

```cpp
void print_sum(int a, int b) {
    std::cout << a << " + " << b << " = " << (a + b) << std::endl;
}

int main() {
    std::thread t(print_sum, 10, 20);
    t.join();
    return 0;
}
```

#### 2.3 ä½¿ç”¨ Lambda

```cpp
int main() {
    int x = 100;
    std::thread t([x]() {
        std::cout << "x = " << x << std::endl;
    });
    t.join();
    return 0;
}
```

#### 2.4 join vs detach

**join():**
- é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç­‰å¾…ç›®æ ‡çº¿ç¨‹å®Œæˆ
- çº¿ç¨‹ç»“æŸåå¯ä»¥å®‰å…¨è®¿é—®çº¿ç¨‹çš„ç»“æœ
- ç±»ä¼¼äº POSIX çš„ `pthread_join()`

**detach():**
- åˆ†ç¦»çº¿ç¨‹ï¼Œè®©å®ƒåœ¨åå°ç‹¬ç«‹è¿è¡Œ
- ä¸»çº¿ç¨‹ä¸å†ç­‰å¾…è¯¥çº¿ç¨‹
- å¿…é¡»ç¡®ä¿çº¿ç¨‹è®¿é—®çš„æ•°æ®åœ¨çº¿ç¨‹ç»“æŸå‰æœ‰æ•ˆ
- ç±»ä¼¼äº POSIX çš„ `pthread_detach()`

```cpp
// ä½¿ç”¨ join
void example_join() {
    std::vector<int> data = {1, 2, 3};
    std::thread t([&data]() {
        for (int i : data) {
            std::cout << i << " ";
        }
    });
    t.join();  // ç­‰å¾…çº¿ç¨‹å®Œæˆï¼Œdata ä»ç„¶æœ‰æ•ˆ
}

// ä½¿ç”¨ detachï¼ˆå±é™©ï¼ï¼‰
void example_detach_dangerous() {
    std::vector<int> data = {1, 2, 3};
    std::thread t([&data]() {  // âš ï¸ å¼•ç”¨æ•è·
        for (int i : data) {
            std::cout << i << " ";
        }
    });
    t.detach();  // âŒ data å¯èƒ½åœ¨çº¿ç¨‹è¿è¡Œå‰å°±è¢«é”€æ¯
}
```

### 3. æ•°æ®ç«äº‰ä¸äº’æ–¥é”

#### 3.1 æ•°æ®ç«äº‰ç¤ºä¾‹

```cpp
#include <iostream>
#include <thread>
#include <vector>

int counter = 0;  // å…±äº«å˜é‡

void increment() {
    for (int i = 0; i < 100000; ++i) {
        ++counter;  // âš ï¸ æ•°æ®ç«äº‰ï¼
    }
}

int main() {
    std::vector<std::thread> threads;
    for (int i = 0; i < 10; ++i) {
        threads.emplace_back(increment);
    }

    for (auto& t : threads) {
        t.join();
    }

    // æœŸæœ›å€¼ï¼š1,000,000
    // å®é™…å€¼ï¼šé€šå¸¸å°äº 1,000,000
    std::cout << "Counter: " << counter << std::endl;
    return 0;
}
```

**ä¸ºä»€ä¹ˆä¼šå‡ºé”™ï¼Ÿ**
- `++counter` ä¸æ˜¯åŸå­æ“ä½œ
- å®é™…åŒ…å«ï¼šè¯»å–ã€åŠ 1ã€å†™å›
- å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¼šå¯¼è‡´æ•°æ®ç«äº‰

#### 3.2 ä½¿ç”¨ mutex ä¿æŠ¤

```cpp
#include <mutex>

std::mutex mtx;
int counter = 0;

void increment_safe() {
    for (int i = 0; i < 100000; ++i) {
        std::lock_guard<std::mutex> lock(mtx);  // RAII é£æ ¼åŠ é”
        ++counter;  // âœ… å—ä¿æŠ¤
    }
}
```

---

## âœ… å®è·µç»ƒä¹ 

### ç»ƒä¹  1ï¼šåˆ›å»ºå¤šä¸ªçº¿ç¨‹

ç¼–å†™ç¨‹åºåˆ›å»º 5 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰“å°è‡ªå·±çš„ ID å’Œä¸€æ¡æ¶ˆæ¯ã€‚

**æœŸæœ›è¾“å‡ºï¼š**
```
Thread 0: Hello
Thread 1: Hello
Thread 2: Hello
Thread 3: Hello
Thread 4: Hello
```

**æç¤ºï¼š** ä½¿ç”¨ `std::this_thread::get_id()`

### ç»ƒä¹  2ï¼šå‚æ•°ä¼ é€’

ç¼–å†™ç¨‹åºï¼Œåˆ›å»ºçº¿ç¨‹è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œï¼Œå¹¶åœ¨ä¸»çº¿ç¨‹ä¸­æ‰“å°ç»“æœã€‚

**è¦æ±‚ï¼š**
- ä½¿ç”¨å…±äº«å˜é‡å­˜å‚¨ç»“æœ
- ä½¿ç”¨ mutex ä¿æŠ¤å…±äº«å˜é‡
- ä¸»çº¿ç¨‹ç­‰å¾…è®¡ç®—å®Œæˆåæ‰“å°ç»“æœ

### ç»ƒä¹  3ï¼šç†è§£æ•°æ®ç«äº‰

è¿è¡Œä¸Šé¢çš„æ•°æ®ç«äº‰ç¤ºä¾‹ï¼ˆ3.1ï¼‰ï¼Œå¤šæ¬¡æ‰§è¡Œï¼Œè§‚å¯Ÿç»“æœçš„å˜åŒ–ã€‚ç„¶åï¼š
1. è§£é‡Šä¸ºä»€ä¹ˆç»“æœæ¯æ¬¡ä¸åŒ
2. ä¿®å¤æ•°æ®ç«äº‰é—®é¢˜
3. éªŒè¯ä¿®å¤åçš„ç»“æœæ­£ç¡®

---

## ğŸ¤” æ€è€ƒé¢˜

1. **ä¸ºä»€ä¹ˆå¿…é¡»è°ƒç”¨ join() æˆ– detach()ï¼Ÿ**
   - å¦‚æœä¸è°ƒç”¨ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
   åœ¨ std::thread å¯¹è±¡çš„ææ„å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå¦‚æœè¯¥çº¿ç¨‹ä»ç„¶æ˜¯ joinable çš„ï¼ˆå³æ²¡è¢« join ä¹Ÿæ²¡è¢« detachï¼‰
   åˆ™ä¼šå‘ç”Ÿå´©æºƒ
   - ç¨‹åºä¼šæ­£å¸¸é€€å‡ºå—ï¼Ÿ
   ä¸ä¼š

2. **ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ joinï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨ detachï¼Ÿ**
   - å„è‡ªçš„é€‚ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ
   Açº¿ç¨‹åˆ›å»ºBçº¿ç¨‹ï¼Œå½“Açº¿ç¨‹éœ€è¦ç­‰å¾…Bçº¿ç¨‹å®Œæˆæ—¶ä½¿ç”¨joinï¼Œå¦åˆ™ç”¨detach
   - detach æœ‰ä»€ä¹ˆé£é™©ï¼Ÿ
    æœ‰Açº¿ç¨‹å·²ç»ç»“æŸå¹¶é‡Šæ”¾èµ„æºï¼ŒBçº¿ç¨‹éœ€è¦Açº¿ç¨‹çš„å˜é‡æ—¶ï¼Œä¼šè®¿é—®åˆ°å·²ç»é‡Šæ”¾çš„å†…å­˜

    
3. **ä¸ºä»€ä¹ˆæ•°æ®ç«äº‰ä¼šå¯¼è‡´é”™è¯¯çš„ç»“æœï¼Ÿ**
   - `++counter` åœ¨æ±‡ç¼–å±‚é¢æ˜¯ä»€ä¹ˆæ“ä½œï¼Ÿ

   - ç”»å‡ºæ—¶åºå›¾è¯´æ˜ä¸¤ä¸ªçº¿ç¨‹å¦‚ä½•äº§ç”Ÿç«äº‰

4. **ä½¿ç”¨ mutex åæ€§èƒ½å¦‚ä½•ï¼Ÿ**
   - ä¸ä¸åŠ é”ç›¸æ¯”æ…¢å¤šå°‘ï¼Ÿ
   - ä¸ºä»€ä¹ˆï¼Ÿ

---

## ğŸ“š å‚è€ƒèµ„æ–™

### C++ å¤šçº¿ç¨‹åŸºç¡€
- [cppreference: std::thread](https://en.cppreference.com/w/cpp/thread/thread)
- [cppreference: std::mutex](https://en.cppreference.com/w/cpp/thread/mutex)
- [C++ Concurrency in Action - Chapter 2](https://www.manning.com/books/c-plus-plus-concurrency-in-action-second-edition)

### æ•°æ®ç«äº‰ä¸åŒæ­¥
- [C++ Memory Model](https://en.cppreference.com/w/cpp/language/memory_model)
- [Race Condition vs Data Race](https://blog.regehr.org/archives/490)

---

## âœ… æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬ä»»åŠ¡å‰ï¼Œè¯·ç¡®è®¤ï¼š

- [ ] å·²å®‰è£…æ”¯æŒ C++11 çš„ç¼–è¯‘å™¨
- [ ] æˆåŠŸç¼–è¯‘å¹¶è¿è¡Œç¤ºä¾‹ä»£ç 
- [ ] ç†è§£ join å’Œ detach çš„åŒºåˆ«
- [ ] èƒ½å¤Ÿåˆ›å»ºçº¿ç¨‹å¹¶ä¼ é€’å‚æ•°
- [ ] ç†è§£æ•°æ®ç«äº‰çš„æ¦‚å¿µ
- [ ] çŸ¥é“å¦‚ä½•ä½¿ç”¨ mutex ä¿æŠ¤å…±äº«æ•°æ®
- [ ] å®Œæˆæ‰€æœ‰ç»ƒä¹ é¢˜
- [ ] æ€è€ƒå¹¶å›ç­”æ€è€ƒé¢˜

---

## ä¸‹ä¸€æ­¥

å®Œæˆæœ¬ä»»åŠ¡åï¼Œç»§ç»­ [Task 1: çº¿ç¨‹åŒ…è£…ç±»](task1_thread_wrapper.md)

åœ¨ Task 1 ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•å°è£…çº¿ç¨‹ï¼Œä¸ºåç»­çš„çº¿ç¨‹æ± å®ç°æ‰“ä¸‹åŸºç¡€ã€‚
